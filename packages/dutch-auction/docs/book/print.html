<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/lib/index.html">❱ lib</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/lib/TokenLibrary.sol/library.TokenLibrary.html">TokenLibrary</a></li></ol></li><li class="chapter-item "><a href="src/DecayFunctions.sol/library.DecayFunctions.html">DecayFunctions</a></li><li class="chapter-item "><a href="src/DutchAuctionErrors.sol/contract.DutchAuctionErrors.html">DutchAuctionErrors</a></li><li class="chapter-item "><a href="src/DutchAuctionEvents.sol/contract.DutchAuctionEvents.html">DutchAuctionEvents</a></li><li class="chapter-item "><a href="src/DutchAuctionLibrary.sol/library.DutchAuctionLibrary.html">DutchAuctionLibrary</a></li><li class="chapter-item "><a href="src/DutchAuctionManager.sol/contract.DutchAuctionManager.html">DutchAuctionManager</a></li><li class="chapter-item "><a href="src/DutchAuctionMath.sol/library.DutchAuctionMath.html">DutchAuctionMath</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/OasisDEX/summer-earn-protocol" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dutch-auction-smart-contract"><a class="header" href="#dutch-auction-smart-contract">Dutch Auction Smart Contract</a></h1>
<p>This project implements a Dutch Auction system using Solidity smart contracts. It's built and tested using the Foundry framework.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="index.html#dutch-auction-smart-contract">Dutch Auction Smart Contract</a>
<ul>
<li><a href="index.html#table-of-contents">Table of Contents</a></li>
<li><a href="index.html#overview">Overview</a></li>
<li><a href="index.html#project-structure">Project Structure</a></li>
<li><a href="index.html#setup">Setup</a></li>
<li><a href="index.html#testing">Testing</a></li>
<li><a href="index.html#deployment">Deployment</a></li>
<li><a href="index.html#contract-details">Contract Details</a>
<ul>
<li><a href="index.html#dutchauctionmanager">DutchAuctionManager</a></li>
<li><a href="index.html#dutchauctionlibrary">DutchAuctionLibrary</a></li>
<li><a href="index.html#dutchauctionerrors">DutchAuctionErrors</a></li>
<li><a href="index.html#dutchauctionevents">DutchAuctionEvents</a></li>
</ul>
</li>
<li><a href="index.html#dutch-auction-lifecycle">Dutch Auction Lifecycle</a></li>
<li><a href="index.html#python-script-for-price-data">Python Script for Price Data</a>
<ul>
<li><a href="index.html#features">Features</a></li>
<li><a href="index.html#usage">Usage</a></li>
</ul>
</li>
<li><a href="index.html#key-features">Key Features</a></li>
<li><a href="index.html#contributing">Contributing</a></li>
<li><a href="index.html#license">License</a></li>
</ul>
</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>A Dutch auction is a type of auction where the price starts high and gradually decreases until a buyer accepts the current price. This implementation allows for multiple auctions to be managed simultaneously, with features such as kicker rewards and support for different price decay models (linear and exponential).</p>
<h2 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h2>
<pre><code>dutch-auction/
├── src/
│   ├── DutchAuctionManager.sol
│   ├── DutchAuctionLibrary.sol
│   ├── DutchAuctionErrors.sol
│   └── DutchAuctionEvents.sol
├── test/
│   ├── DutchAuction.t.sol
│   └── DutchAuction.fuzz.t.sol
├── script/
│   └── DeployDutchAuction.s.sol
├── utils/
|   ├── generate_price_data.py
│   ├── price_decay_comparison.png
│   └── expected_prices.json
├── foundry.toml
└── README.md
</code></pre>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<ol>
<li>
<p>Clone the repository:</p>
<pre><code class="language-bash">git clone https://github.com/oasisdex/summer-earn-protocol.git
cd packages/dutch-auction
</code></pre>
</li>
<li>
<p>Install Foundry if you haven't already:</p>
<pre><code class="language-bash">curl -L https://foundry.paradigm.xyz | bash
foundryup
</code></pre>
</li>
<li>
<p>Install dependencies:</p>
<pre><code class="language-bash">forge install
</code></pre>
</li>
<li>
<p>Install Python dependencies for the script:</p>
<pre><code class="language-bash">pip install matplotlib
</code></pre>
</li>
</ol>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Run the test suite using Forge:</p>
<pre><code class="language-bash">forge test
</code></pre>
<p>For more verbose output:</p>
<pre><code class="language-bash">forge test -vvv
</code></pre>
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<ol>
<li>
<p>Set up your <code>.env</code> file with your RPC URL and private key:</p>
<pre><code class="language-plaintext">RPC_URL=your_rpc_url
PRIVATE_KEY=your_private_key
</code></pre>
</li>
<li>
<p>Run the deployment script:</p>
<pre><code class="language-bash">forge script script/DeployDutchAuction.s.sol:DeployDutchAuction --rpc-url $RPC_URL --private-key $PRIVATE_KEY --broadcast
</code></pre>
</li>
</ol>
<h2 id="contract-details"><a class="header" href="#contract-details">Contract Details</a></h2>
<h3 id="dutchauctionmanager"><a class="header" href="#dutchauctionmanager">DutchAuctionManager</a></h3>
<p>The example implementation contract that handles the creation and management of auctions.</p>
<h3 id="dutchauctionlibrary"><a class="header" href="#dutchauctionlibrary">DutchAuctionLibrary</a></h3>
<p>A library containing the core logic for Dutch auctions, including price calculations and token purchases.</p>
<p>Important note for usage:
The contract using this library is responsible for:</p>
<ul>
<li>Storing the auctions</li>
<li>Managing auction IDs</li>
<li>Checking for duplicate auction IDs</li>
<li>Handling any additional logic specific to the implementation</li>
</ul>
<p>The library itself does not manage these aspects, as it's designed to be flexible and reusable.</p>
<p>For an example of how to implement these responsibilities, please refer to the DutchAuctionManager contract. This contract demonstrates how to use the DutchAuctionLibrary while managing auction storage, IDs, and other implementation-specific details.</p>
<h3 id="dutchauctionerrors"><a class="header" href="#dutchauctionerrors">DutchAuctionErrors</a></h3>
<p>A contract defining custom errors used throughout the system.</p>
<h3 id="dutchauctionevents"><a class="header" href="#dutchauctionevents">DutchAuctionEvents</a></h3>
<p>A contract defining events emitted by the auction system.</p>
<h2 id="dutch-auction-lifecycle"><a class="header" href="#dutch-auction-lifecycle">Dutch Auction Lifecycle</a></h2>
<p>The following diagram illustrates the lifecycle of a Dutch Auction:</p>
<p><img src="./utils/lifecycle.png" alt="Dutch Auction Lifecycle" /></p>
<ol>
<li><strong>Auction Creation</strong>: The auction is created with specified parameters (tokens, duration, prices, etc.).</li>
<li><strong>Auction Starts</strong>: The auction begins, and the price starts decreasing over time.</li>
<li><strong>Active Auction</strong>: During this phase, buyers can purchase tokens at the current price.</li>
<li><strong>Token Purchase</strong>: When a buyer purchases tokens, the remaining token amount is updated.</li>
<li><strong>Auction End Time Reached</strong>: If the auction duration elapses before all tokens are sold, the auction enters the finalization phase.</li>
<li><strong>Finalize Auction</strong>: Any unsold tokens are transferred to the specified recipient.</li>
<li><strong>Auction Finalized</strong>: The auction is marked as finalized, and an event is emitted.</li>
</ol>
<p>The auction can end in two ways:</p>
<ul>
<li>All tokens are sold before the end time is reached.</li>
<li>The end time is reached with some tokens remaining unsold.</li>
</ul>
<p>In both cases, the auction is finalized, and any necessary token transfers are completed.</p>
<h2 id="python-script-for-price-data"><a class="header" href="#python-script-for-price-data">Python Script for Price Data</a></h2>
<p>A Python script (<code>utils/generate_price_data.py</code>) is provided to generate expected price data for both linear and exponential price decay models. It also plots these decays for visual comparison.</p>
<p><img src="utils/price_decay_comparison.png" alt="" /></p>
<h3 id="features"><a class="header" href="#features">Features</a></h3>
<ul>
<li><strong>Configurable Intervals</strong>: Adjust the number of intervals to compute prices over the auction duration.</li>
<li><strong>Output</strong>: Generates a JSON file (<code>expected_prices.json</code>) with expected prices and a PNG file (<code>price_decay_comparison.png</code>) for visual comparison.</li>
<li></li>
</ul>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<ol>
<li>Edit the <code>num_intervals</code> variable in <code>utils/generate_price_data.py</code> to change the number of time intervals for price calculation.</li>
<li>Run the script:
<pre><code class="language-bash">python utils/generate_price_data.py
</code></pre>
</li>
</ol>
<p>This script will create a JSON file and a PNG image showing the price decay for the auction's duration.</p>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<ul>
<li>Multiple simultaneous auctions</li>
<li>Support for both linear and exponential price decay</li>
<li>Kicker reward system</li>
<li>Automatic finalization when all tokens are sold</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Contributions are welcome! Please feel free to submit a Pull Request.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>This project is licensed under the MIT License.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="src/lib/TokenLibrary.sol/library.TokenLibrary.html">TokenLibrary</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tokenlibrary"><a class="header" href="#tokenlibrary">TokenLibrary</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/lib/TokenLibrary.sol">Git Source</a></p>
<p><strong>Author:</strong>
halaprix</p>
<p>This library provides utility functions for handling token decimals and conversions</p>
<p><em>Implements functions to get token decimals and convert amounts between different decimal representations</em></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="getdecimals"><a class="header" href="#getdecimals">getDecimals</a></h3>
<p>Retrieves the number of decimals for a given token</p>
<p><em>Uses a low-level call to get the decimals, defaulting to 18 if the call fails</em></p>
<p>*Process:</p>
<ol>
<li>Attempts to call the 'decimals()' function on the token contract</li>
<li>If the call succeeds, decodes and returns the result</li>
<li>If the call fails, returns 18 as a default value*</li>
</ol>
<p><em>Note: This function assumes that tokens follow the ERC20 standard.
Non-standard tokens may cause unexpected behavior.</em></p>
<pre><code class="language-solidity">function getDecimals(IERC20 token) internal view returns (uint8);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>IERC20</code></td><td>The ERC20 token to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The number of decimals for the token</td></tr>
</tbody></table>
</div>
<h3 id="towei"><a class="header" href="#towei">toWei</a></h3>
<p>Converts an amount from its original decimal representation to 18 decimals (wei)</p>
<p><em>Adjusts the amount based on the difference between the original decimals and 18</em></p>
<p>*Calculation:</p>
<ul>
<li>If decimals == 18, no conversion needed</li>
<li>If decimals &gt; 18, divide by 10^(decimals - 18)</li>
<li>If decimals &lt; 18, multiply by 10^(18 - decimals)*</li>
</ul>
<p><em>Note: This function assumes that the input amount is in its original decimal representation.
Incorrect input decimals will lead to incorrect conversions.</em></p>
<pre><code class="language-solidity">function toWei(uint256 amount, uint8 decimals) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to convert</td></tr>
<tr><td><code>decimals</code></td><td><code>uint8</code></td><td>The original number of decimals</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The amount converted to 18 decimal representation</td></tr>
</tbody></table>
</div>
<h3 id="fromwei"><a class="header" href="#fromwei">fromWei</a></h3>
<p>Converts an amount from 18 decimals (wei) to a specified decimal representation</p>
<p><em>Adjusts the amount based on the difference between 18 and the target decimals</em></p>
<p>*Calculation:</p>
<ul>
<li>If decimals == 18, no conversion needed</li>
<li>If decimals &gt; 18, multiply by 10^(decimals - 18)</li>
<li>If decimals &lt; 18, divide by 10^(18 - decimals)*</li>
</ul>
<p><em>Note: This function assumes that the input amount is in 18 decimal representation.
Incorrect input amounts will lead to incorrect conversions.</em></p>
<pre><code class="language-solidity">function fromWei(uint256 amount, uint8 decimals) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount in 18 decimal representation to convert</td></tr>
<tr><td><code>decimals</code></td><td><code>uint8</code></td><td>The target number of decimals</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The amount converted to the specified decimal representation</td></tr>
</tbody></table>
</div>
<h3 id="convertdecimals"><a class="header" href="#convertdecimals">convertDecimals</a></h3>
<p>Converts an amount from one decimal representation to another</p>
<p><em>Performs the conversion directly to avoid precision loss</em></p>
<p>*Process:</p>
<ol>
<li>If fromDecimals == toDecimals, no conversion needed</li>
<li>If fromDecimals &lt; toDecimals, multiply by 10^(toDecimals - fromDecimals)</li>
<li>If fromDecimals &gt; toDecimals, divide by 10^(fromDecimals - toDecimals)*</li>
</ol>
<p><em>Note: This function provides a more precise way to convert between any two decimal representations.
It avoids the intermediate step of converting to 18 decimals, which can cause precision loss.</em></p>
<pre><code class="language-solidity">function convertDecimals(uint256 amount, uint8 fromDecimals, uint8 toDecimals) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to convert</td></tr>
<tr><td><code>fromDecimals</code></td><td><code>uint8</code></td><td>The original number of decimals</td></tr>
<tr><td><code>toDecimals</code></td><td><code>uint8</code></td><td>The target number of decimals</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The amount converted to the target decimal representation</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="decayfunctions"><a class="header" href="#decayfunctions">DecayFunctions</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DecayFunctions.sol">Git Source</a></p>
<p><strong>Author:</strong>
halaprix</p>
<p>This library provides functions to calculate price decay for Dutch auctions</p>
<p><em>Implements both linear and exponential decay functions</em></p>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="calculatedecay"><a class="header" href="#calculatedecay">calculateDecay</a></h3>
<p>Calculates the current price based on the specified decay type</p>
<p><em>This function acts as a wrapper for the specific decay calculations in DutchAuctionMath</em></p>
<p>*Calculation process:</p>
<ol>
<li>Check if the auction has ended (timeElapsed &gt;= totalDuration)</li>
<li>If the auction has ended, return the end price</li>
<li>If the auction is still active, calculate the current price using the specified decay function</li>
<li>For Linear decay, use DutchAuctionMath.linearDecay</li>
<li>For Exponential decay, use DutchAuctionMath.exponentialDecay*</li>
</ol>
<p>*Note on precision:</p>
<ul>
<li>All price calculations are performed with high precision using the DutchAuctionMath library</li>
<li>The input prices and result can have different decimal places, allowing for flexible token configurations*</li>
</ul>
<p>*Usage:</p>
<ul>
<li>This function should be called periodically to get the current price of the auctioned item</li>
<li>It can handle different token decimals for both input and output, making it versatile for various token pairs*</li>
</ul>
<pre><code class="language-solidity">function calculateDecay(
    DecayType decayType,
    uint256 startPrice,
    uint256 endPrice,
    uint256 timeElapsed,
    uint256 totalDuration,
    uint8 decimals,
    uint8 resultDecimals
)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>decayType</code></td><td><code>DecayType</code></td><td>The type of decay function to use (Linear or Exponential)</td></tr>
<tr><td><code>startPrice</code></td><td><code>uint256</code></td><td>The starting price of the auction (in token units)</td></tr>
<tr><td><code>endPrice</code></td><td><code>uint256</code></td><td>The ending price of the auction (in token units)</td></tr>
<tr><td><code>timeElapsed</code></td><td><code>uint256</code></td><td>The time elapsed since the start of the auction</td></tr>
<tr><td><code>totalDuration</code></td><td><code>uint256</code></td><td>The total duration of the auction</td></tr>
<tr><td><code>decimals</code></td><td><code>uint8</code></td><td>The number of decimals for the input prices</td></tr>
<tr><td><code>resultDecimals</code></td><td><code>uint8</code></td><td>The desired number of decimals for the result</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current price based on the specified decay function</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="invaliddecaytype"><a class="header" href="#invaliddecaytype">InvalidDecayType</a></h3>
<p>Thrown when the decay type is invalid</p>
<pre><code class="language-solidity">error InvalidDecayType();
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="decaytype"><a class="header" href="#decaytype">DecayType</a></h3>
<p>Enum representing the types of decay functions available</p>
<p><em>Used to select between linear and exponential decay in calculations</em></p>
<pre><code class="language-solidity">enum DecayType {
    Linear,
    Exponential
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dutchauctionerrors-1"><a class="header" href="#dutchauctionerrors-1">DutchAuctionErrors</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DutchAuctionErrors.sol">Git Source</a></p>
<p>This contract defines custom errors for the Dutch Auction system</p>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<h3 id="invalidduration"><a class="header" href="#invalidduration">InvalidDuration</a></h3>
<p>Thrown when the auction duration is set to zero</p>
<p><em>The auction duration must be greater than zero</em></p>
<pre><code class="language-solidity">error InvalidDuration();
</code></pre>
<h3 id="invalidprices"><a class="header" href="#invalidprices">InvalidPrices</a></h3>
<p>Thrown when the start price is not greater than the end price</p>
<p><em>The start price must be strictly greater than the end price</em></p>
<pre><code class="language-solidity">error InvalidPrices();
</code></pre>
<h3 id="invalidtokenamount"><a class="header" href="#invalidtokenamount">InvalidTokenAmount</a></h3>
<p>Thrown when the total number of tokens for auction is zero</p>
<p><em>The total token amount must be greater than zero</em></p>
<pre><code class="language-solidity">error InvalidTokenAmount();
</code></pre>
<h3 id="invalidkickerrewardpercentage"><a class="header" href="#invalidkickerrewardpercentage">InvalidKickerRewardPercentage</a></h3>
<p>Thrown when the kicker reward percentage is greater than 100%</p>
<p><em>The kicker reward percentage must be between 0 and 100 inclusive</em></p>
<pre><code class="language-solidity">error InvalidKickerRewardPercentage();
</code></pre>
<h3 id="auctionnotactive"><a class="header" href="#auctionnotactive">AuctionNotActive</a></h3>
<p>Thrown when trying to buy tokens outside the active auction period</p>
<p><em>This can occur if trying to buy after the auction has ended</em></p>
<pre><code class="language-solidity">error AuctionNotActive(uint256 auctionId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The ID of the auction being interacted with</td></tr>
</tbody></table>
</div>
<h3 id="insufficienttokensavailable"><a class="header" href="#insufficienttokensavailable">InsufficientTokensAvailable</a></h3>
<p>Thrown when trying to buy more tokens than are available in the auction</p>
<p><em>The requested purchase amount must not exceed the remaining tokens</em></p>
<pre><code class="language-solidity">error InsufficientTokensAvailable();
</code></pre>
<h3 id="auctionnotended"><a class="header" href="#auctionnotended">AuctionNotEnded</a></h3>
<p>Thrown when trying to finalize an auction before its end time</p>
<p><em>The auction can only be finalized after its scheduled end time</em></p>
<pre><code class="language-solidity">error AuctionNotEnded(uint256 auctionId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The ID of the auction being interacted with</td></tr>
</tbody></table>
</div>
<h3 id="auctionalreadyfinalized"><a class="header" href="#auctionalreadyfinalized">AuctionAlreadyFinalized</a></h3>
<p>Thrown when trying to interact with an auction that has already been finalized</p>
<p><em>Once an auction is finalized, no further interactions should be possible</em></p>
<p><em>auction is finalized when either the end time is reached or all tokens are sold</em></p>
<pre><code class="language-solidity">error AuctionAlreadyFinalized(uint256 auctionId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The ID of the auction being interacted with</td></tr>
</tbody></table>
</div>
<h3 id="invalidauctiontoken"><a class="header" href="#invalidauctiontoken">InvalidAuctionToken</a></h3>
<p>Thrown when the auction token is invalid</p>
<pre><code class="language-solidity">error InvalidAuctionToken();
</code></pre>
<h3 id="invalidpaymenttoken"><a class="header" href="#invalidpaymenttoken">InvalidPaymentToken</a></h3>
<p>Thrown when the payment token is invalid</p>
<pre><code class="language-solidity">error InvalidPaymentToken();
</code></pre>
<h3 id="auctionnotfound"><a class="header" href="#auctionnotfound">AuctionNotFound</a></h3>
<p>Thrown when the auction has not been found</p>
<pre><code class="language-solidity">error AuctionNotFound();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dutchauctionevents-1"><a class="header" href="#dutchauctionevents-1">DutchAuctionEvents</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DutchAuctionEvents.sol">Git Source</a></p>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="auctioncreated"><a class="header" href="#auctioncreated">AuctionCreated</a></h3>
<p><em>Emitted when a new auction is created</em></p>
<pre><code class="language-solidity">event AuctionCreated(
    uint256 indexed auctionId, address indexed auctionKicker, uint256 totalTokens, uint256 kickerRewardAmount
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the created auction</td></tr>
<tr><td><code>auctionKicker</code></td><td><code>address</code></td><td>The address of the account that initiated the auction</td></tr>
<tr><td><code>totalTokens</code></td><td><code>uint256</code></td><td>The total number of tokens being auctioned</td></tr>
<tr><td><code>kickerRewardAmount</code></td><td><code>uint256</code></td><td>The number of tokens reserved as a reward for the auction kicker</td></tr>
</tbody></table>
</div>
<h3 id="tokenspurchased"><a class="header" href="#tokenspurchased">TokensPurchased</a></h3>
<p><em>Emitted when tokens are purchased in an auction</em></p>
<pre><code class="language-solidity">event TokensPurchased(uint256 indexed auctionId, address indexed buyer, uint256 amount, uint256 price);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the auction</td></tr>
<tr><td><code>buyer</code></td><td><code>address</code></td><td>The address of the account that purchased the tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The number of tokens purchased</td></tr>
<tr><td><code>price</code></td><td><code>uint256</code></td><td>The price per token at the time of purchase</td></tr>
</tbody></table>
</div>
<h3 id="auctionfinalized"><a class="header" href="#auctionfinalized">AuctionFinalized</a></h3>
<p><em>Emitted when an auction is finalized</em></p>
<pre><code class="language-solidity">event AuctionFinalized(uint256 indexed auctionId, uint256 soldTokens, uint256 unsoldTokens);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the finalized auction</td></tr>
<tr><td><code>soldTokens</code></td><td><code>uint256</code></td><td>The total number of tokens sold in the auction</td></tr>
<tr><td><code>unsoldTokens</code></td><td><code>uint256</code></td><td>The number of tokens that remained unsold</td></tr>
</tbody></table>
</div>
<h3 id="kickerrewardclaimed"><a class="header" href="#kickerrewardclaimed">KickerRewardClaimed</a></h3>
<pre><code class="language-solidity">event KickerRewardClaimed(uint256 indexed auctionId, address indexed kicker, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the auction</td></tr>
<tr><td><code>kicker</code></td><td><code>address</code></td><td>The address of the account that initiated the auction</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The number of tokens claimed as a reward</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="dutchauctionlibrary-1"><a class="header" href="#dutchauctionlibrary-1">DutchAuctionLibrary</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DutchAuctionLibrary.sol">Git Source</a></p>
<p><strong>Author:</strong>
halaprix</p>
<p>This library implements core functionality for running Dutch auctions</p>
<p><em>This library is designed to be used by a contract managing multiple auctions</em></p>
<p>*Auction Mechanics:</p>
<ol>
<li>Auction Lifecycle:</li>
</ol>
<ul>
<li>Creation: An auction is created with specified parameters (tokens, duration, prices, etc.).</li>
<li>Active Period: The auction is active from its start time until its end time or until all tokens are sold.</li>
<li>Finalization: The auction is finalized either when all tokens are sold or after the end time is reached.</li>
</ul>
<ol start="2">
<li>Price Movement:</li>
</ol>
<ul>
<li>The price is calculated on-demand based on the current timestamp using a specified decay function.</li>
<li>It's not updated per block, but rather computed when <code>getCurrentPrice</code> is called, using current timestamp.</li>
<li>This ensures smooth price decay over time, independent of block creation.</li>
</ul>
<ol start="3">
<li>Buying Limits:</li>
</ol>
<ul>
<li>Users can buy any amount of tokens up to the remaining amount in the auction.</li>
<li>There's no minimum purchase amount enforced by the contract.</li>
</ul>
<ol start="4">
<li>Price Calculation and Rounding:</li>
</ol>
<ul>
<li>The current price is calculated using the specified decay function (linear or exponential).</li>
<li>Rounding is done towards zero (floor) to ensure the contract never overcharges.</li>
<li>For utmost precision, all calculations use the PRBMath library for fixed-point arithmetic.</li>
</ul>
<ol start="5">
<li>Token Handling:</li>
</ol>
<ul>
<li>The auctioning contract must be pre-approved to spend the tokens used for payment.</li>
<li>Tokens should be transferred to the auctioning contract before or during auction creation.</li>
<li>The contract holds the tokens and transfers them to buyers upon successful purchases.</li>
</ul>
<ol start="6">
<li>Kicker Reward:</li>
</ol>
<ul>
<li>A portion of the auctioned tokens is set aside as a reward for the auction initiator (kicker).</li>
<li>This reward is transferred to the kicker immediately upon auction creation.</li>
</ul>
<ol start="7">
<li>Unsold Tokens:</li>
</ol>
<ul>
<li>Any unsold tokens at the end of the auction are transferred to a specified recipient address.</li>
<li>This transfer occurs during the finalization of the auction.*</li>
</ul>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="createauction"><a class="header" href="#createauction">createAuction</a></h3>
<p>Creates a new Dutch auction</p>
<p><em>This function initializes a new auction with the given parameters</em></p>
<pre><code class="language-solidity">function createAuction(AuctionParams memory params) external returns (Auction memory auction);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>params</code></td><td><code>AuctionParams</code></td><td>The parameters for the new auction</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The created Auction struct</td></tr>
</tbody></table>
</div>
<h3 id="getcurrentprice"><a class="header" href="#getcurrentprice">getCurrentPrice</a></h3>
<p>Calculates the current price of tokens in an ongoing auction</p>
<p><em>This function computes the price based on the elapsed time and decay function</em></p>
<pre><code class="language-solidity">function getCurrentPrice(Auction memory auction) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The Auction struct</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current price of tokens in the auction</td></tr>
</tbody></table>
</div>
<h3 id="buytokens"><a class="header" href="#buytokens">buyTokens</a></h3>
<p>Allows a user to purchase tokens from an ongoing auction</p>
<p><em>This function handles the token purchase, including price calculation and token transfers</em></p>
<pre><code class="language-solidity">function buyTokens(Auction storage auction, uint256 _amount) internal returns (uint256 totalCost);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The storage pointer to the auction</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The number of tokens to purchase</td></tr>
</tbody></table>
</div>
<h3 id="finalizeauction"><a class="header" href="#finalizeauction">finalizeAuction</a></h3>
<p>Finalizes an auction after its end time has been reached</p>
<p><em>This function can be called by anyone after the auction end time</em></p>
<pre><code class="language-solidity">function finalizeAuction(Auction storage auction) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The storage pointer to the auction to be finalized</td></tr>
</tbody></table>
</div>
<h3 id="_finalizeauction"><a class="header" href="#_finalizeauction">_finalizeAuction</a></h3>
<p>Internal function to handle auction finalization logic</p>
<p><em>This function distributes unsold tokens and marks the auction as finalized</em></p>
<pre><code class="language-solidity">function _finalizeAuction(Auction storage auction) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The storage pointer to the auction to be finalized</td></tr>
</tbody></table>
</div>
<h3 id="_claimkickerreward"><a class="header" href="#_claimkickerreward">_claimKickerReward</a></h3>
<p>Claims the kicker reward for the auction</p>
<p><em>Transfers the kicker reward to the kicker's address immediately upon auction creation</em></p>
<pre><code class="language-solidity">function _claimKickerReward(Auction memory auction) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auction</code></td><td><code>Auction</code></td><td>The auction to claim the kicker reward from</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="auctionconfig"><a class="header" href="#auctionconfig">AuctionConfig</a></h3>
<p>Struct representing the configuration of a Dutch auction</p>
<p><em>This struct contains all the fixed parameters set at auction creation</em></p>
<pre><code class="language-solidity">struct AuctionConfig {
    IERC20 auctionToken;
    IERC20 paymentToken;
    uint40 startTime;
    uint40 endTime;
    uint8 auctionTokenDecimals;
    uint8 paymentTokenDecimals;
    address auctionKicker;
    address unsoldTokensRecipient;
    uint40 id;
    DecayFunctions.DecayType decayType;
    uint256 startPrice;
    uint256 endPrice;
    uint256 totalTokens;
    uint256 kickerRewardAmount;
}
</code></pre>
<h3 id="auctionstate"><a class="header" href="#auctionstate">AuctionState</a></h3>
<p>Struct representing the dynamic state of a Dutch auction</p>
<p><em>This struct contains all the variables that change during the auction's lifecycle</em></p>
<pre><code class="language-solidity">struct AuctionState {
    uint256 remainingTokens;
    bool isFinalized;
}
</code></pre>
<h3 id="auction"><a class="header" href="#auction">Auction</a></h3>
<p>Struct representing a complete Dutch auction</p>
<p><em>This struct combines the fixed configuration and dynamic state of an auction</em></p>
<pre><code class="language-solidity">struct Auction {
    AuctionConfig config;
    AuctionState state;
}
</code></pre>
<h3 id="auctionparams"><a class="header" href="#auctionparams">AuctionParams</a></h3>
<p>Struct containing parameters for creating a new auction</p>
<p><em>This struct is used as an input to the createAuction function</em></p>
<pre><code class="language-solidity">struct AuctionParams {
    uint256 auctionId;
    IERC20 auctionToken;
    IERC20 paymentToken;
    uint40 duration;
    uint256 startPrice;
    uint256 endPrice;
    uint256 totalTokens;
    Percentage kickerRewardPercentage;
    address kicker;
    address unsoldTokensRecipient;
    DecayFunctions.DecayType decayType;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dutchauctionmanager-1"><a class="header" href="#dutchauctionmanager-1">DutchAuctionManager</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DutchAuctionManager.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ReentrancyGuard, <a href="src/DutchAuctionManager.sol//src/DutchAuctionErrors.sol/contract.DutchAuctionErrors.html">DutchAuctionErrors</a>, <a href="src/DutchAuctionManager.sol//src/DutchAuctionEvents.sol/contract.DutchAuctionEvents.html">DutchAuctionEvents</a></p>
<p><strong>Author:</strong>
Your Name</p>
<p>This contract manages multiple Dutch auctions using the DutchAuctionLibrary</p>
<p><em>This contract is responsible for creating and managing auctions, and acts as the interface for users to interact
with auctions</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="auctions"><a class="header" href="#auctions">auctions</a></h3>
<pre><code class="language-solidity">mapping(uint256 =&gt; DutchAuctionLibrary.Auction) public auctions;
</code></pre>
<h3 id="auctioncounter"><a class="header" href="#auctioncounter">auctionCounter</a></h3>
<pre><code class="language-solidity">uint256 public auctionCounter;
</code></pre>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="createauction-1"><a class="header" href="#createauction-1">createAuction</a></h3>
<p>Creates a new Dutch auction</p>
<p><em>This function creates a new auction and returns its unique identifier</em></p>
<pre><code class="language-solidity">function createAuction(
    IERC20 _auctionToken,
    IERC20 _paymentToken,
    uint256 _duration,
    uint256 _startPrice,
    uint256 _endPrice,
    uint256 _totalTokens,
    Percentage _kickerRewardPercentage,
    address _unsoldTokensRecipient,
    DecayFunctions.DecayType _decayType
)
    external
    nonReentrant
    returns (uint256 auctionId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_auctionToken</code></td><td><code>IERC20</code></td><td>The address of the token being auctioned</td></tr>
<tr><td><code>_paymentToken</code></td><td><code>IERC20</code></td><td>The address of the token used for payment</td></tr>
<tr><td><code>_duration</code></td><td><code>uint256</code></td><td>The duration of the auction in seconds</td></tr>
<tr><td><code>_startPrice</code></td><td><code>uint256</code></td><td>The starting price of the auctioned token</td></tr>
<tr><td><code>_endPrice</code></td><td><code>uint256</code></td><td>The ending price of the auctioned token</td></tr>
<tr><td><code>_totalTokens</code></td><td><code>uint256</code></td><td>The total number of tokens being auctioned</td></tr>
<tr><td><code>_kickerRewardPercentage</code></td><td><code>Percentage</code></td><td>The percentage of sold tokens to be given as reward to the auction kicker</td></tr>
<tr><td><code>_unsoldTokensRecipient</code></td><td><code>address</code></td><td>The address to receive any unsold tokens at the end of the auction</td></tr>
<tr><td><code>_decayType</code></td><td><code>DecayFunctions.DecayType</code></td><td>The type of price decay function to use for the auction</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the created auction</td></tr>
</tbody></table>
</div>
<h3 id="getcurrentprice-1"><a class="header" href="#getcurrentprice-1">getCurrentPrice</a></h3>
<p>Gets the current price of tokens in an ongoing auction</p>
<p><em>This function returns the current price based on the auction's decay function and elapsed time</em></p>
<pre><code class="language-solidity">function getCurrentPrice(uint256 _auctionId) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the auction</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current price of tokens in the auction</td></tr>
</tbody></table>
</div>
<h3 id="buytokens-1"><a class="header" href="#buytokens-1">buyTokens</a></h3>
<p>Allows a user to purchase tokens from an ongoing auction</p>
<p><em>This function handles the token purchase, including price calculation and token transfers</em></p>
<pre><code class="language-solidity">function buyTokens(uint256 _auctionId, uint256 _amount) external nonReentrant returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the auction</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The number of tokens to purchase</td></tr>
</tbody></table>
</div>
<h3 id="finalizeauction-1"><a class="header" href="#finalizeauction-1">finalizeAuction</a></h3>
<p>Finalizes an auction after its end time has been reached</p>
<p><em>This function can be called by anyone after the auction end time</em></p>
<pre><code class="language-solidity">function finalizeAuction(uint256 _auctionId) external nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_auctionId</code></td><td><code>uint256</code></td><td>The unique identifier of the auction to be finalized</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="dutchauctionmath"><a class="header" href="#dutchauctionmath">DutchAuctionMath</a></h1>
<p><a href="https://github.com/OasisDEX/summer-earn-protocol/blob/c6aec955808af03c05b24342f892f71facee60db/src/DutchAuctionMath.sol">Git Source</a></p>
<p><strong>Author:</strong>
halaprix</p>
<p>This library provides mathematical functions for Dutch auction calculations with support for various token
decimals</p>
<p><em>Uses PRBMath library for precise calculations with fixed-point numbers and TokenLibrary for decimal conversions</em></p>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="lineardecay"><a class="header" href="#lineardecay">linearDecay</a></h3>
<p>Calculates the current price based on linear decay</p>
<p><em>The price decreases linearly from startPrice to endPrice over the duration</em></p>
<p>*Process:</p>
<ol>
<li>Convert start and end prices to 18 decimals for precise calculation</li>
<li>Calculate the price difference and decay amount using 18 decimal precision</li>
<li>Subtract the decay amount from the start price</li>
<li>Convert the result back to the desired number of decimals*</li>
</ol>
<pre><code class="language-solidity">function linearDecay(
    uint256 startPrice,
    uint256 endPrice,
    uint256 timeElapsed,
    uint256 totalDuration,
    uint8 priceDecimals,
    uint8 resultDecimals
)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startPrice</code></td><td><code>uint256</code></td><td>The starting price of the auction</td></tr>
<tr><td><code>endPrice</code></td><td><code>uint256</code></td><td>The ending price of the auction</td></tr>
<tr><td><code>timeElapsed</code></td><td><code>uint256</code></td><td>The time elapsed since the start of the auction</td></tr>
<tr><td><code>totalDuration</code></td><td><code>uint256</code></td><td>The total duration of the auction</td></tr>
<tr><td><code>priceDecimals</code></td><td><code>uint8</code></td><td>The number of decimals for the price values</td></tr>
<tr><td><code>resultDecimals</code></td><td><code>uint8</code></td><td>The desired number of decimals for the result</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current price based on linear decay</td></tr>
</tbody></table>
</div>
<h3 id="exponentialdecay"><a class="header" href="#exponentialdecay">exponentialDecay</a></h3>
<p>Calculates the current price based on exponential decay</p>
<p><em>The price decreases exponentially from startPrice to endPrice over the duration</em></p>
<p>*Process:</p>
<ol>
<li>Convert start and end prices to 18 decimals for precise calculation</li>
<li>Calculate the remaining time and its square</li>
<li>Calculate the decay amount using the formula: priceDifference * (remainingTime^2 / totalDuration^2)</li>
<li>Add the decay amount to the end price</li>
<li>Convert the result back to the desired number of decimals*</li>
</ol>
<pre><code class="language-solidity">function exponentialDecay(
    uint256 startPrice,
    uint256 endPrice,
    uint256 timeElapsed,
    uint256 totalDuration,
    uint8 priceDecimals,
    uint8 resultDecimals
)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startPrice</code></td><td><code>uint256</code></td><td>The starting price of the auction</td></tr>
<tr><td><code>endPrice</code></td><td><code>uint256</code></td><td>The ending price of the auction</td></tr>
<tr><td><code>timeElapsed</code></td><td><code>uint256</code></td><td>The time elapsed since the start of the auction</td></tr>
<tr><td><code>totalDuration</code></td><td><code>uint256</code></td><td>The total duration of the auction</td></tr>
<tr><td><code>priceDecimals</code></td><td><code>uint8</code></td><td>The number of decimals for the price values</td></tr>
<tr><td><code>resultDecimals</code></td><td><code>uint8</code></td><td>The desired number of decimals for the result</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current price based on exponential decay</td></tr>
</tbody></table>
</div>
<h3 id="calculatetotalcost"><a class="header" href="#calculatetotalcost">calculateTotalCost</a></h3>
<p>Calculates the total cost for a given price and amount, considering different token decimals</p>
<p><em>Converts values to 18 decimals using TokenLibrary, performs the calculation, and converts the result back</em></p>
<p>*Process:</p>
<ol>
<li>Convert both price and amount to 18 decimals for precise calculation</li>
<li>Multiply the converted price and amount using PRBMath's high-precision operations</li>
<li>Convert the result back to the desired number of decimals*</li>
</ol>
<p><em>Note: This function ensures high precision by performing all intermediate calculations
with 18 decimal places, regardless of the input or output decimal specifications.</em></p>
<pre><code class="language-solidity">function calculateTotalCost(
    uint256 price,
    uint256 amount,
    uint8 priceDecimals,
    uint8 amountDecimals,
    uint8 resultDecimals
)
    internal
    pure
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>price</code></td><td><code>uint256</code></td><td>The price per unit</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The number of units</td></tr>
<tr><td><code>priceDecimals</code></td><td><code>uint8</code></td><td>The number of decimals for the price token</td></tr>
<tr><td><code>amountDecimals</code></td><td><code>uint8</code></td><td>The number of decimals for the amount token</td></tr>
<tr><td><code>resultDecimals</code></td><td><code>uint8</code></td><td>The desired number of decimals for the result</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total cost</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
