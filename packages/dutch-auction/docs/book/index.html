<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Home</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html" class="active">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/lib/index.html">❱ lib</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/lib/TokenLibrary.sol/library.TokenLibrary.html">TokenLibrary</a></li></ol></li><li class="chapter-item "><a href="src/DecayFunctions.sol/library.DecayFunctions.html">DecayFunctions</a></li><li class="chapter-item "><a href="src/DutchAuctionErrors.sol/contract.DutchAuctionErrors.html">DutchAuctionErrors</a></li><li class="chapter-item "><a href="src/DutchAuctionEvents.sol/contract.DutchAuctionEvents.html">DutchAuctionEvents</a></li><li class="chapter-item "><a href="src/DutchAuctionLibrary.sol/library.DutchAuctionLibrary.html">DutchAuctionLibrary</a></li><li class="chapter-item "><a href="src/DutchAuctionManager.sol/contract.DutchAuctionManager.html">DutchAuctionManager</a></li><li class="chapter-item "><a href="src/DutchAuctionMath.sol/library.DutchAuctionMath.html">DutchAuctionMath</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/OasisDEX/summer-earn-protocol" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dutch-auction-smart-contract"><a class="header" href="#dutch-auction-smart-contract">Dutch Auction Smart Contract</a></h1>
<p>This project implements a Dutch Auction system using Solidity smart contracts. It's built and tested using the Foundry framework.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#dutch-auction-smart-contract">Dutch Auction Smart Contract</a>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#project-structure">Project Structure</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#contract-details">Contract Details</a>
<ul>
<li><a href="#dutchauctionmanager">DutchAuctionManager</a></li>
<li><a href="#dutchauctionlibrary">DutchAuctionLibrary</a></li>
<li><a href="#dutchauctionerrors">DutchAuctionErrors</a></li>
<li><a href="#dutchauctionevents">DutchAuctionEvents</a></li>
</ul>
</li>
<li><a href="#dutch-auction-lifecycle">Dutch Auction Lifecycle</a></li>
<li><a href="#python-script-for-price-data">Python Script for Price Data</a>
<ul>
<li><a href="#features">Features</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</li>
<li><a href="#key-features">Key Features</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>A Dutch auction is a type of auction where the price starts high and gradually decreases until a buyer accepts the current price. This implementation allows for multiple auctions to be managed simultaneously, with features such as kicker rewards and support for different price decay models (linear and exponential).</p>
<h2 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h2>
<pre><code>dutch-auction/
├── src/
│   ├── DutchAuctionManager.sol
│   ├── DutchAuctionLibrary.sol
│   ├── DutchAuctionErrors.sol
│   └── DutchAuctionEvents.sol
├── test/
│   ├── DutchAuction.t.sol
│   └── DutchAuction.fuzz.t.sol
├── script/
│   └── DeployDutchAuction.s.sol
├── utils/
|   ├── generate_price_data.py
│   ├── price_decay_comparison.png
│   └── expected_prices.json
├── foundry.toml
└── README.md
</code></pre>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<ol>
<li>
<p>Clone the repository:</p>
<pre><code class="language-bash">git clone https://github.com/oasisdex/summer-earn-protocol.git
cd packages/dutch-auction
</code></pre>
</li>
<li>
<p>Install Foundry if you haven't already:</p>
<pre><code class="language-bash">curl -L https://foundry.paradigm.xyz | bash
foundryup
</code></pre>
</li>
<li>
<p>Install dependencies:</p>
<pre><code class="language-bash">forge install
</code></pre>
</li>
<li>
<p>Install Python dependencies for the script:</p>
<pre><code class="language-bash">pip install matplotlib
</code></pre>
</li>
</ol>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Run the test suite using Forge:</p>
<pre><code class="language-bash">forge test
</code></pre>
<p>For more verbose output:</p>
<pre><code class="language-bash">forge test -vvv
</code></pre>
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<ol>
<li>
<p>Set up your <code>.env</code> file with your RPC URL and private key:</p>
<pre><code class="language-plaintext">RPC_URL=your_rpc_url
PRIVATE_KEY=your_private_key
</code></pre>
</li>
<li>
<p>Run the deployment script:</p>
<pre><code class="language-bash">forge script script/DeployDutchAuction.s.sol:DeployDutchAuction --rpc-url $RPC_URL --private-key $PRIVATE_KEY --broadcast
</code></pre>
</li>
</ol>
<h2 id="contract-details"><a class="header" href="#contract-details">Contract Details</a></h2>
<h3 id="dutchauctionmanager"><a class="header" href="#dutchauctionmanager">DutchAuctionManager</a></h3>
<p>The example implementation contract that handles the creation and management of auctions.</p>
<h3 id="dutchauctionlibrary"><a class="header" href="#dutchauctionlibrary">DutchAuctionLibrary</a></h3>
<p>A library containing the core logic for Dutch auctions, including price calculations and token purchases.</p>
<p>Important note for usage:
The contract using this library is responsible for:</p>
<ul>
<li>Storing the auctions</li>
<li>Managing auction IDs</li>
<li>Checking for duplicate auction IDs</li>
<li>Handling any additional logic specific to the implementation</li>
</ul>
<p>The library itself does not manage these aspects, as it's designed to be flexible and reusable.</p>
<p>For an example of how to implement these responsibilities, please refer to the DutchAuctionManager contract. This contract demonstrates how to use the DutchAuctionLibrary while managing auction storage, IDs, and other implementation-specific details.</p>
<h3 id="dutchauctionerrors"><a class="header" href="#dutchauctionerrors">DutchAuctionErrors</a></h3>
<p>A contract defining custom errors used throughout the system.</p>
<h3 id="dutchauctionevents"><a class="header" href="#dutchauctionevents">DutchAuctionEvents</a></h3>
<p>A contract defining events emitted by the auction system.</p>
<h2 id="dutch-auction-lifecycle"><a class="header" href="#dutch-auction-lifecycle">Dutch Auction Lifecycle</a></h2>
<p>The following diagram illustrates the lifecycle of a Dutch Auction:</p>
<p><img src="./utils/lifecycle.png" alt="Dutch Auction Lifecycle" /></p>
<ol>
<li><strong>Auction Creation</strong>: The auction is created with specified parameters (tokens, duration, prices, etc.).</li>
<li><strong>Auction Starts</strong>: The auction begins, and the price starts decreasing over time.</li>
<li><strong>Active Auction</strong>: During this phase, buyers can purchase tokens at the current price.</li>
<li><strong>Token Purchase</strong>: When a buyer purchases tokens, the remaining token amount is updated.</li>
<li><strong>Auction End Time Reached</strong>: If the auction duration elapses before all tokens are sold, the auction enters the finalization phase.</li>
<li><strong>Finalize Auction</strong>: Any unsold tokens are transferred to the specified recipient.</li>
<li><strong>Auction Finalized</strong>: The auction is marked as finalized, and an event is emitted.</li>
</ol>
<p>The auction can end in two ways:</p>
<ul>
<li>All tokens are sold before the end time is reached.</li>
<li>The end time is reached with some tokens remaining unsold.</li>
</ul>
<p>In both cases, the auction is finalized, and any necessary token transfers are completed.</p>
<h2 id="python-script-for-price-data"><a class="header" href="#python-script-for-price-data">Python Script for Price Data</a></h2>
<p>A Python script (<code>utils/generate_price_data.py</code>) is provided to generate expected price data for both linear and exponential price decay models. It also plots these decays for visual comparison.</p>
<p><img src="utils/price_decay_comparison.png" alt="" /></p>
<h3 id="features"><a class="header" href="#features">Features</a></h3>
<ul>
<li><strong>Configurable Intervals</strong>: Adjust the number of intervals to compute prices over the auction duration.</li>
<li><strong>Output</strong>: Generates a JSON file (<code>expected_prices.json</code>) with expected prices and a PNG file (<code>price_decay_comparison.png</code>) for visual comparison.</li>
<li></li>
</ul>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<ol>
<li>Edit the <code>num_intervals</code> variable in <code>utils/generate_price_data.py</code> to change the number of time intervals for price calculation.</li>
<li>Run the script:
<pre><code class="language-bash">python utils/generate_price_data.py
</code></pre>
</li>
</ol>
<p>This script will create a JSON file and a PNG image showing the price decay for the auction's duration.</p>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<ul>
<li>Multiple simultaneous auctions</li>
<li>Support for both linear and exponential price decay</li>
<li>Kicker reward system</li>
<li>Automatic finalization when all tokens are sold</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Contributions are welcome! Please feel free to submit a Pull Request.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>This project is licensed under the MIT License.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="src/lib/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="src/lib/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>


    </div>
    </body>
</html>
